#!/usr/local/bin/expect -f
# This Expect script navigates through dr dotenv setup interactive wizard
# pressing Enter to accept all default values

# Uncomment for debugging
# exp_internal 1

# Use TERM=dumb to prevent terminal color probing which causes OSC sequences
set env(TERM) dumb

set timeout 10

# Get the directory argument (or use current directory if not provided)
set test_dir [lindex $argv 0]
if {$test_dir == ""} {
    set test_dir "."
}

# Change to the test directory
cd $test_dir

spawn dr dotenv setup

match_max 100000

# Simple loop: just keep pressing Enter whenever we see ">" or selection menus
# until we reach the final menu or EOF

expect {
    -re ">" {
        # Input prompt - press Enter to accept default
        send -- "\r"
        exp_continue
    }
    -re "\\d+ items" {
        # Selection menu with N items - press Enter to select default
        send -- "\r"
        exp_continue
    }
    "Environment Variables Menu" {
        # Final menu - press Enter to exit
        send -- "\r"
        exp_continue
    }
    eof {
        # Done
    }
    timeout {
        puts "\nTimeout - wizard may have finished"
    }
}

wait
